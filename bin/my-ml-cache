#! /bin/bash

# This is supposed to be spawned of 
# .bash_profile and will create a cache
# for modules in tmp
if [[ -z ${HPCTOYS_ROOT} || -z "${LMOD_CMD}"   ]]; then
  exit
fi
ME=$(whoami)
MCACHE="${TMPDIR}/${ME}-modules.cache"
ml --terse avail \
    | grep -v '^/' \
    > "${MCACHE}" 2>&1

# get the top words
tr -sc "[A-Z][a-z][0-9]'" '[\012*]' < "${MCACHE}" | \
  tr '[A-Z]' '[a-z]' | \
  sort | uniq -c | sort -nr | \
  head -n 50


